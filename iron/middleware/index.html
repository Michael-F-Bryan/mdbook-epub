<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `middleware` mod in crate `iron`."><meta name="keywords" content="rust, rustlang, rust-lang, middleware"><title>iron::middleware - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css"><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="shortcut icon" href="https://avatars0.githubusercontent.com/u/7853871?s=256"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../iron/index.html'><div class='logo-container'><img src='https://avatars0.githubusercontent.com/u/7853871?s=128' alt='logo'></div></a><p class='location'>Module middleware</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li></ul></div><p class='location'><a href='../index.html'>iron</a></p><script>window.sidebarCurrent = {name: 'middleware', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../../src/iron/middleware/mod.rs.html#1-461' title='goto source code'>[src]</a></span><span class='in-band'>Module <a href='../index.html'>iron</a>::<wbr><a class="mod" href=''>middleware</a></span></h1><div class='docblock'><p>This module contains Iron's middleware and handler system, the fundamental
building blocks for handling HTTP requests and generating responses.</p>
<h1 id="handlers" class="section-header"><a href="#handlers">Handlers</a></h1>
<p>A <code>Handler</code> will produce a <code>Response</code> given a <code>Request</code>. Most handlers are
functions or closures that accept a <code>&amp;mut Request</code> as an argument and return
an <code>IronResult</code> containing a <code>Response</code>. An <code>IronResult</code> is returned instead of
directly returning a <code>Response</code> in order to indicate a possibility of
failure (e.g. database timeout).</p>
<p>Here's an example of a <code>Handler</code>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">iron</span>::<span class="ident">prelude</span>::<span class="kw-2">*</span>;
<span class="kw">use</span> <span class="ident">iron</span>::<span class="ident">Handler</span>;
<span class="kw">use</span> <span class="ident">iron</span>::<span class="ident">status</span>;

<span class="kw">fn</span> <span class="ident">hello_handler</span>(<span class="ident">req</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">Request</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">IronResult</span><span class="op">&lt;</span><span class="ident">Response</span><span class="op">&gt;</span> {
    <span class="prelude-val">Ok</span>(<span class="ident">Response</span>::<span class="ident">with</span>((<span class="ident">status</span>::<span class="prelude-val">Ok</span>, <span class="string">&quot;Hello world!&quot;</span>)))
};</pre></div>
<h1 id="middleware" class="section-header"><a href="#middleware">Middleware</a></h1>
<p>In situations involving more complex logic, it may be desirable to transform
<code>Request</code>s passed to a <code>Handler</code> or altering <code>Response</code>s sent to the
clients. For example, an authorization step could only allow requests sent
by authorized users to be passed to a <code>Handler</code> and respond to all other
requests with a 403 status code. To faciliate such use cases, Iron's
middleware system allows <code>Handler</code>s to be extended by defining middleware,
which will perform transformations.</p>
<p>There are three types of middleware:</p>
<ul>
<li>A <code>BeforeMiddleware</code> alters a <code>Request</code>. It can be useful for handling
control flow (e.g. routing and authorization).</li>
<li>An <code>AroundMiddleware</code> wraps a <code>Handler</code>, changing both the <code>Response</code>
passed to the <code>Handler</code> and the returned <code>Response</code>.</li>
<li>An <code>AfterMiddleware</code> performs <code>Response</code> post-processing. It can be used
for editing headers or logging <code>Response</code>s, but it should <em>not</em> be used for
changing the body of a <code>Response</code>.</li>
</ul>
<p>See the documentation for each middleware for more details.</p>
<h2 id="defining-the-middleware-pipeline" class="section-header"><a href="#defining-the-middleware-pipeline">Defining the middleware pipeline</a></h2>
<p>A <code>Chain</code> is a <code>Handler</code> that wraps another <code>Handler</code>. It is used to attach
middleware to the wrapped <code>Handler</code> using a <code>link</code> method corresponding to
each type of middleware. A sample middleware pipeline is shown below:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">iron</span>::<span class="ident">prelude</span>::<span class="kw-2">*</span>;
<span class="kw">use</span> <span class="ident">iron</span>::<span class="ident">middleware</span>::<span class="kw-2">*</span>;


<span class="kw">struct</span> <span class="ident">RequestLoggingMiddleware</span>;
<span class="kw">impl</span> <span class="ident">BeforeMiddleware</span> <span class="kw">for</span> <span class="ident">RequestLoggingMiddleware</span> {
    <span class="kw">fn</span> <span class="ident">before</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">req</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">Request</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">IronResult</span><span class="op">&lt;</span>()<span class="op">&gt;</span> {
        <span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;{:?}&quot;</span>, <span class="ident">req</span>);
        <span class="prelude-val">Ok</span>(())
    }
}

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">chain</span> <span class="op">=</span> <span class="ident">Chain</span>::<span class="ident">new</span>(<span class="ident">hello_handler</span>);
<span class="ident">chain</span>.<span class="ident">link_before</span>(<span class="ident">RequestLoggingMiddleware</span> {});
<span class="comment">// Since a Chain is a Handler, chain can be passed to Iron::new without any problems.</span>
<span class="comment">// Iron::new(chain).http(&quot;localhost:3000&quot;).unwrap();</span></pre></div>
<h1 id="the-request-handling-flow" class="section-header"><a href="#the-request-handling-flow">The Request Handling Flow</a></h1>
<p>A diagram modeling the entire middleware system process is shown below:</p>
<pre><code class="language-plain">[b] = BeforeMiddleware
[a] = AfterMiddleware
[[h]] = AroundMiddleware
[h] = Handler
</code></pre>
<p>With no errors, the flow looks like:</p>
<pre><code class="language-plain">[b] -&gt; [b] -&gt; [b] -&gt; [[[[h]]]] -&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]
</code></pre>
<p>A request first travels through all <code>BeforeMiddleware</code>, then a <code>Response</code> is
generated by the <code>Handler</code>, which can be an arbitrary nesting of
<code>AroundMiddleware</code>, then all <code>AfterMiddleware</code> are called with both the
<code>Request</code> and <code>Response</code>. After all <code>AfterMiddleware</code> have been fired, the
response is written back to the client.</p>
<p>Iron's error handling system is pragmatic and focuses on tracking two pieces
of information for error receivers (other middleware):</p>
<ul>
<li>The cause of the error</li>
<li>The result (what to do about) the error.</li>
</ul>
<p>The cause of the error is represented simply by the error itself, and the
result of the error, representing the action to take in response to the
error, is a complete Response, which will be sent at the end of the error
flow.</p>
<p>When an error is thrown in Iron by any middleware or handler returning an
<code>Err</code> variant with an <code>IronError</code>, the flow of the <code>Request</code> switches to the
error flow, which proceeds to just call the <code>catch</code> method of middleware and
sidesteps the <code>Handler</code> entirely, since there is already a <code>Response</code> in the
error.</p>
<p>A <code>Request</code> can exit the error flow by returning an Ok from any of the catch
methods. This resumes the flow at the middleware immediately following the
middleware which handled the error. It is impossible to &quot;go back&quot; to an
earlier middleware that was skipped.</p>
<p>Generally speaking, returning a 5XX error code means that the error flow
should be entered by raising an explicit error. Dealing with 4XX errors is
trickier, since the server may not want to recognize an error that is
entirely the clients fault; handling of 4XX error codes is up to to each
application and middleware author.</p>
<p>Middleware authors should be cognizant that their middleware may be skipped
during the error flow. Anything that <em>must</em> be done to each <code>Request</code> or
<code>Response</code> should be run during both the normal and error flow by
implementing the <code>catch</code> method to also do the necessary action.</p>
</div><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table><tr class='module-item'><td><a class="struct" href="struct.Chain.html" title='iron::middleware::Chain struct'>Chain</a></td><td class='docblock-short'><p>The middleware chain used in Iron.</p>
</td></tr></table><h2 id='traits' class='section-header'><a href="#traits">Traits</a></h2>
<table><tr class='module-item'><td><a class="trait" href="trait.AfterMiddleware.html" title='iron::middleware::AfterMiddleware trait'>AfterMiddleware</a></td><td class='docblock-short'><p><code>AfterMiddleware</code> are fired after a <code>Handler</code> is called inside of a Chain.</p>
</td></tr><tr class='module-item'><td><a class="trait" href="trait.AroundMiddleware.html" title='iron::middleware::AroundMiddleware trait'>AroundMiddleware</a></td><td class='docblock-short'><p><code>AroundMiddleware</code> are used to wrap and replace the <code>Handler</code> in a <code>Chain</code>.</p>
</td></tr><tr class='module-item'><td><a class="trait" href="trait.BeforeMiddleware.html" title='iron::middleware::BeforeMiddleware trait'>BeforeMiddleware</a></td><td class='docblock-short'><p><code>BeforeMiddleware</code> are fired before a <code>Handler</code> is called inside of a Chain.</p>
</td></tr><tr class='module-item'><td><a class="trait" href="trait.Handler.html" title='iron::middleware::Handler trait'>Handler</a></td><td class='docblock-short'><p><code>Handler</code>s are responsible for handling requests by creating Responses from Requests.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "iron";</script><script src="../../aliases.js"></script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>